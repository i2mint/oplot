<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>oplot.plot_stats &mdash; oplot 0.1.2 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/toggleprompt.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> oplot
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot.html">oplot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/matrix.html">oplot.matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/multi_plot.html">oplot.multi_plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/multiplots.html">oplot.multiplots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/my.html">oplot.my</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/outlier_scores.html">oplot.outlier_scores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/plot_audio.html">oplot.plot_audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/plot_data_set.html">oplot.plot_data_set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/plot_stats.html">oplot.plot_stats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/ui_scores_mapping.html">oplot.ui_scores_mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module_docs/oplot/util.html">oplot.util</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">oplot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>oplot.plot_stats</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for oplot.plot_stats</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions to represent the accuracy of outlier or classification algorithms&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">oplot.util</span> <span class="kn">import</span> <span class="n">fixed_step_chunker</span>


<div class="viewcode-block" id="plot_freqs_stats"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.plot_freqs_stats">[docs]</a><span class="k">def</span> <span class="nf">plot_freqs_stats</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">upper_frequency</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">1025</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    X is intended to be the list/array of spectra, the function plots the mean, max and min of each frequency.</span>
<span class="sd">    If normalized, the min/max/mean entries are all divided by the the minimum value in the mean array.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_each_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">min_each_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mean_each_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">normalized</span><span class="p">:</span>
        <span class="n">normalization_factor</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mean_each_freq</span><span class="p">)</span>
        <span class="n">max_each_freq</span> <span class="o">/=</span> <span class="n">normalization_factor</span>
        <span class="n">min_each_freq</span> <span class="o">/=</span> <span class="n">normalization_factor</span>
        <span class="n">mean_each_freq</span> <span class="o">/=</span> <span class="n">normalization_factor</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_frequency</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">),</span> <span class="n">max_each_freq</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_frequency</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">),</span> <span class="n">min_each_freq</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_frequency</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">),</span> <span class="n">mean_each_freq</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;intensities&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">freq_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_frequency</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">),</span> <span class="n">freq_var</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;variance&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;variance&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="make_heatmap"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.make_heatmap">[docs]</a><span class="k">def</span> <span class="nf">make_heatmap</span><span class="p">(</span>
    <span class="n">matrix_results</span><span class="p">,</span>
    <span class="n">tags</span><span class="p">,</span>
    <span class="n">rounding</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">fig_size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
    <span class="n">make_symmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">fill_diag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes a heatmap plot of the matrix_results where the entries are rounded.</span>
<span class="sd">    If matrix_results is upper or lower diagonal and make_symmetric is set to true,</span>
<span class="sd">    plot will be made symmetric by copying the strict upper or lower half.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">make_symmetric</span><span class="p">:</span>
        <span class="n">matrix_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">matrix_results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">matrix_results</span> <span class="o">=</span> <span class="n">matrix_results</span> <span class="o">+</span> <span class="n">matrix_copy</span>
    <span class="k">if</span> <span class="n">fill_diag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">matrix_results</span><span class="p">,</span> <span class="n">fill_diag</span><span class="p">)</span>
    <span class="c1"># rounding its entries for cleaner plot</span>
    <span class="n">rounding_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rounding</span><span class="p">))</span>
    <span class="n">matrix_results</span> <span class="o">=</span> <span class="n">rounding_func</span><span class="p">(</span><span class="n">matrix_results</span><span class="p">)</span>

    <span class="c1"># making the plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matrix_results</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="c1"># We want to show all ticks...</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)))</span>
    <span class="c1"># ... and label them with the respective list entries</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
    <span class="c1"># Rotate the tick labels and set their alignment.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">)</span>
    <span class="c1"># Loop over data dimensions and create text annotations.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">matrix_results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span>
            <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pairwise Classification accuracy &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_confusion_matrix"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.plot_confusion_matrix">[docs]</a><span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span>
    <span class="n">y_true</span><span class="p">,</span>
    <span class="n">y_pred</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span>
    <span class="n">saving_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">color_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function prints and plots the confusion matrix.</span>
<span class="sd">    Normalization can be applied by setting `normalize=True`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Only use the labels that appear in the data</span>
    <span class="k">if</span> <span class="n">classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>

    <span class="c1"># Compute confusion matrix</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cm</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color_bar</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1"># We want to show all ticks...</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">xticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">yticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="c1"># ... and label them with the respective list entries</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Rotate the tick labels and set their alignment.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">)</span>

    <span class="c1"># Loop over data dimensions and create text annotations.</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># remove this condition if a 0 in each cell with no confusion is wanted</span>
            <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">j</span><span class="p">,</span>
                    <span class="n">i</span><span class="p">,</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fmt</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="p">)</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">saving_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">saving_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="list_mult"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.list_mult">[docs]</a><span class="k">def</span> <span class="nf">list_mult</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">random_remainder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extend the multiplication of lists by an integer naturally to float.</span>
<span class="sd">    EX: [1,2] * 1.5 = [1,2,1]</span>
<span class="sd">    If random_remainder is set to True, the decimal part of the new list will be chose at random from l.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mult_in</span><span class="p">,</span> <span class="n">remain</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">random_remainder</span><span class="p">:</span>
        <span class="n">remainder</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">*</span> <span class="n">remain</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">remainder</span> <span class="o">=</span> <span class="n">l</span><span class="p">[:</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">*</span> <span class="n">remain</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">l</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">mult_in</span><span class="p">)</span> <span class="o">+</span> <span class="n">remainder</span></div>


<div class="viewcode-block" id="rebalancing_normal_outlier_ratio"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.rebalancing_normal_outlier_ratio">[docs]</a><span class="k">def</span> <span class="nf">rebalancing_normal_outlier_ratio</span><span class="p">(</span><span class="n">normal_scores</span><span class="p">,</span> <span class="n">outlier_scores</span><span class="p">,</span> <span class="n">percent_outliers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rebalance artificially the ratio outlier/(normal + outlier) to the specified percent_outliers.</span>
<span class="sd">    Does this by copying data points, use with caution!</span>
<span class="sd">    :param normal_scores:</span>
<span class="sd">    :param outlier_scores:</span>
<span class="sd">    :param percent_outliers:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n_normal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">normal_scores</span><span class="p">)</span>
    <span class="n">n_outlier</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outlier_scores</span><span class="p">)</span>
    <span class="n">correction_multiplier</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">n_outlier</span> <span class="o">/</span> <span class="n">n_normal</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percent_outliers</span><span class="p">)</span> <span class="o">/</span> <span class="n">percent_outliers</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">correction_multiplier</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_mult</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">normal_scores</span><span class="p">),</span> <span class="n">correction_multiplier</span><span class="p">)),</span>
            <span class="n">outlier_scores</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">normal_scores</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_mult</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">outlier_scores</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">correction_multiplier</span><span class="p">)),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="rebalance_scores"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.rebalance_scores">[docs]</a><span class="k">def</span> <span class="nf">rebalance_scores</span><span class="p">(</span><span class="n">test_scores</span><span class="p">,</span> <span class="n">test_truth</span><span class="p">,</span> <span class="n">outlier_proportion</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Re-balances the ratio of normal/outlier scores by copying the normal/outliers scores when needed.</span>
<span class="sd">    This is useful to compute real life precision/recall and other such metrics when the actual proportion</span>
<span class="sd">    of outlier/normal is known but not achieved in the test set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">test_normal_scores</span> <span class="o">=</span> <span class="n">test_scores</span><span class="p">[</span><span class="n">test_truth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">test_anom_scores</span> <span class="o">=</span> <span class="n">test_scores</span><span class="p">[</span><span class="n">test_truth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">normal_scores</span><span class="p">,</span> <span class="n">anom_scores</span> <span class="o">=</span> <span class="n">rebalancing_normal_outlier_ratio</span><span class="p">(</span>
        <span class="n">test_normal_scores</span><span class="p">,</span> <span class="n">test_anom_scores</span><span class="p">,</span> <span class="n">percent_outliers</span><span class="o">=</span><span class="n">outlier_proportion</span>
    <span class="p">)</span>
    <span class="n">bal_test_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">normal_scores</span><span class="p">,</span> <span class="n">anom_scores</span><span class="p">))</span>
    <span class="n">bal_test_truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">normal_scores</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">anom_scores</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bal_test_scores</span><span class="p">,</span> <span class="n">bal_test_truth</span></div>


<div class="viewcode-block" id="get_tn_fp_fn_tp"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.get_tn_fp_fn_tp">[docs]</a><span class="k">def</span> <span class="nf">get_tn_fp_fn_tp</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    compute the counts of true negative, false positive, false negative and true positive as predicted</span>
<span class="sd">    by the outlier score for the given threshold</span>
<span class="sd">    :param truth: a list of 0 and 1&#39;s, 0 meaning normal and 1 meaning outlier</span>
<span class="sd">    :param scores: a list of outlier scores, of same length as truth</span>
<span class="sd">    :param threshold: a float, any score under is predicted as normal and above as outlier</span>
<span class="sd">    :return: true negative, false positive, false negative, true positive</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">thresh_funct</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">thresh_funct</span><span class="p">,</span> <span class="n">scores</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span></div>


<div class="viewcode-block" id="make_tables_tn_fp_fn_tp"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.make_tables_tn_fp_fn_tp">[docs]</a><span class="k">def</span> <span class="nf">make_tables_tn_fp_fn_tp</span><span class="p">(</span>
    <span class="n">truth</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">threshold_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_thresholds</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a table of counts of tn, fp, fn, tp for n_thresholds equally spaced in threshold_range</span>

<span class="sd">    :param truth:  a list of 0 and 1&#39;s, 0 meaning normal and 1 meaning outlier</span>
<span class="sd">    :param scores: a list of outlier scores, of same length as truth</span>
<span class="sd">    :param threshold_range: two values in a tuple or list. The thresholds will be picked within these.</span>
<span class="sd">    :param n_thresholds: the number of thresholds to produce</span>
<span class="sd">    :return: a panda dataframe with rows of the form (threshold, tn, tp, fn, fp)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">threshold_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">threshold_range</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">truth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">truth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">threshold_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">threshold_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n_thresholds</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">get_tn_fp_fn_tp</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
        <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">threshold</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">tn</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">fp</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tp</span><span class="p">)])</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">row</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="s1">&#39;Threshold&#39;</span><span class="p">,</span>
            <span class="s1">&#39;True Negative&#39;</span><span class="p">,</span>
            <span class="s1">&#39;False Positive&#39;</span><span class="p">,</span>
            <span class="s1">&#39;False Negative&#39;</span><span class="p">,</span>
            <span class="s1">&#39;True Positive&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">total_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth</span><span class="p">)</span>
        <span class="n">total_negative</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">truth</span><span class="p">)</span> <span class="o">-</span> <span class="n">total_positive</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;True Negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;True Negative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">total_negative</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;False Positive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;False Positive&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">total_negative</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;False Negative&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;False Negative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">total_positive</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;True Positive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;True Positive&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">total_positive</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="make_tn_fp_fn_tp_tag_lists"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.make_tn_fp_fn_tp_tag_lists">[docs]</a><span class="k">def</span> <span class="nf">make_tn_fp_fn_tp_tag_lists</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dictionary with the keys being tp, tn, fp and fn and the corresponding values are the indices of the scores/truth/tags</span>
<span class="sd">    for the given threshold. If a list of tags of the sounds corresponding to each scores is given, the values of the dict will</span>
<span class="sd">    be those tags rather than indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">truth</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">to_pick_from</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">to_pick_from</span> <span class="o">=</span> <span class="n">tags</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">threshold_pred</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">]</span>
    <span class="n">true_positive</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">to_pick_from</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">threshold_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">truth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">true_negative</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">to_pick_from</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">threshold_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">truth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">false_positive</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">to_pick_from</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">threshold_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">truth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">false_negative</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">to_pick_from</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">threshold_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">truth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">counter</span><span class="p">:</span>
        <span class="n">true_positive</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">true_positive</span><span class="p">)</span>
        <span class="n">true_negative</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">true_negative</span><span class="p">)</span>
        <span class="n">false_positive</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">false_positive</span><span class="p">)</span>
        <span class="n">false_negative</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">false_negative</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;tp&#39;</span><span class="p">:</span> <span class="n">true_positive</span><span class="p">,</span>
        <span class="s1">&#39;tn&#39;</span><span class="p">:</span> <span class="n">true_negative</span><span class="p">,</span>
        <span class="s1">&#39;fp&#39;</span><span class="p">:</span> <span class="n">false_positive</span><span class="p">,</span>
        <span class="s1">&#39;fn&#39;</span><span class="p">:</span> <span class="n">false_negative</span><span class="p">,</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="vlines"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.vlines">[docs]</a><span class="k">def</span> <span class="nf">vlines</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="n">marker_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot vlines in a more intuitive way than the default matplotlib version&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ymax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ymax</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ymax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to specify ymax&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">marker_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">marker_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="o">**</span><span class="n">marker_kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
        <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
        <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="make_normal_outlier_timeline"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.make_normal_outlier_timeline">[docs]</a><span class="k">def</span> <span class="nf">make_normal_outlier_timeline</span><span class="p">(</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">scores</span><span class="p">,</span>
    <span class="n">y_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vertical_sep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">saving_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fig_size</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;normal/outlier scores&#39;</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">legend_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">title_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">label_for_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_n_cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticks_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticks_rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots all scores grouped by their y values in order specified by y_order or np.unique(y) is left to None.</span>
<span class="sd">    :param scores: an array of outlier scores</span>
<span class="sd">    :param y: an array of tags, each tag will get its own color on the plot and its name on the legend</span>
<span class="sd">              The vertical line will also be grouped according to the tags, in the order given in y_order</span>
<span class="sd">    :param fig_size: the size of the plot</span>
<span class="sd">    :param line_width: the thickness of the line on the plot</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">label_for_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label_for_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">y_order</span><span class="p">:</span>
        <span class="n">y_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">y_order</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;y_order does not include the values present in y&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">smooth</span><span class="p">:</span>
        <span class="n">new_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_y_order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y_order</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">scores_i</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">smooth_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="n">i</span><span class="p">],</span> <span class="n">window_size</span><span class="o">=</span><span class="n">smooth</span><span class="p">))</span>
                <span class="n">new_scores</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scores_i</span><span class="p">)</span>
                <span class="n">new_y</span> <span class="o">+=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores_i</span><span class="p">)</span>
                <span class="n">new_y_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;There are less scores corresponding to </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> than the smoothing window size. &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;These scores will be dropped&#39;</span>
                <span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_scores</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_y</span><span class="p">)</span>
        <span class="n">y_order</span> <span class="o">=</span> <span class="n">new_y_order</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_order</span><span class="p">)))</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n_points_drawn</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_order</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="n">tag</span><span class="p">]</span>
        <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_points_drawn</span><span class="p">,</span> <span class="n">n_points_drawn</span> <span class="o">+</span> <span class="n">n_points</span><span class="p">),</span>
            <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_for_y</span><span class="p">(</span><span class="n">tag</span><span class="p">),</span>
            <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">n_points_drawn</span> <span class="o">+=</span> <span class="n">n_points</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xticks_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">xticks_rotation</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xticks_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span>
            <span class="n">ticks</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="n">xticks_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">xticks_rotation</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xticks_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">xticks_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">xticks_rotation</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vertical_sep</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">group_len</span> <span class="o">=</span> <span class="n">apply_function_on_consecutive</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">vertical_lines_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">group_len</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
            <span class="n">vertical_lines_pos</span><span class="p">,</span>
            <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
            <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">vertical_sep</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
            <span class="n">vertical_sep</span><span class="p">,</span>
            <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
            <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">legend_size</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">legend_size</span><span class="p">},</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="n">legend_n_cols</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_font_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">saving_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">saving_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="pick_equally_spaced_points"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.pick_equally_spaced_points">[docs]</a><span class="k">def</span> <span class="nf">pick_equally_spaced_points</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param values: a list of values</span>
<span class="sd">    :param n_points: the number of indices to choose</span>
<span class="sd">    :return: a list of indices to choose from the list values in order for these picked values</span>
<span class="sd">             to be as equally spaced as possible, starting with the first value and ending with the final value</span>

<span class="sd">    DO NOT TRUST THIS FUNCTION! It is made only for increasing values and is only somewhat accurate if the values</span>
<span class="sd">    are &quot;fine&quot; compared to the number of point n_points. It works well for what it is intended: finding equally spaced</span>
<span class="sd">    points on a precision/recall curve if many points are available on the curve.</span>

<span class="sd">    &gt;&gt;&gt; pick_equally_spaced_points([1,2,3], 3)</span>
<span class="sd">    array([0, 1, 2])</span>
<span class="sd">    &gt;&gt;&gt; pick_equally_spaced_points(range(300), 3)</span>
<span class="sd">    array([  0, 150, 299])</span>
<span class="sd">    &gt;&gt;&gt; pick_equally_spaced_points([1, 1.1, 1.2, 4, 5, 6], 3)</span>
<span class="sd">    array([0, 3, 5])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">min_value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_value</span> <span class="o">-</span> <span class="n">min_value</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># first and last are picked by default</span>
    <span class="n">points_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_points</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">spacing</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">points_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">points_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_idx</span><span class="p">)</span></div>


<span class="c1"># TODO: make the integer values show as integer instead of floats</span>
<div class="viewcode-block" id="render_mpl_table"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.render_mpl_table">[docs]</a><span class="k">def</span> <span class="nf">render_mpl_table</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">col_width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
    <span class="n">row_height</span><span class="o">=</span><span class="mf">0.625</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
    <span class="n">header_color</span><span class="o">=</span><span class="s1">&#39;#40466e&#39;</span><span class="p">,</span>
    <span class="n">row_colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#f1f1f2&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">],</span>
    <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">header_columns</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">path_to_save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">round_decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">cols_to_round</span><span class="o">=</span><span class="p">(),</span>
    <span class="n">cols_to_int</span><span class="o">=</span><span class="s1">&#39;all_other&#39;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take a pandas dataframe and represents it with a picture. This allows to save a .png version of the dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">round_decimals</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols_to_round</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="n">round_decimals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols_to_round</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">round_decimals</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cols_to_int</span> <span class="o">==</span> <span class="s1">&#39;all_others&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cols_to_round</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">mpl_table</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">table</span><span class="p">(</span>
        <span class="n">cellText</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="n">mpl_table</span><span class="o">.</span><span class="n">auto_set_font_size</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mpl_table</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">font_size</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">mpl_table</span><span class="o">.</span><span class="n">_cells</span><span class="p">):</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edge_color</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">header_columns</span><span class="p">:</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">set_text_props</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">header_color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">row_colors</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_colors</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">path_to_save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># all these scores except for MCC gives a score between 0 and 1.</span>
<span class="c1"># I normalized MMC into what I call NNMC in order to keep the same scale for all.</span>
<span class="n">base_statistics_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;TPR&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">),</span>
    <span class="c1"># sensitivity, recall, hit rate, or true positive rate</span>
    <span class="s1">&#39;TNR&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">tn</span>
    <span class="o">/</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span><span class="p">),</span>  <span class="c1"># specificity, selectivity or true negative rate</span>
    <span class="s1">&#39;PPV&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">tp</span>
    <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">),</span>  <span class="c1"># precision or positive predictive value</span>
    <span class="s1">&#39;NPV&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">tn</span> <span class="o">/</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span><span class="p">),</span>  <span class="c1"># negative predictive value</span>
    <span class="s1">&#39;FNR&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">fn</span> <span class="o">/</span> <span class="p">(</span><span class="n">fn</span> <span class="o">+</span> <span class="n">tp</span><span class="p">),</span>  <span class="c1"># miss rate or false negative rate</span>
    <span class="s1">&#39;FPR&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">fp</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">),</span>  <span class="c1"># fall-out or false positive rate</span>
    <span class="s1">&#39;FDR&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">fp</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">tp</span><span class="p">),</span>  <span class="c1"># false discovery rate</span>
    <span class="s1">&#39;FOR&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">fn</span> <span class="o">/</span> <span class="p">(</span><span class="n">fn</span> <span class="o">+</span> <span class="n">tn</span><span class="p">),</span>  <span class="c1"># false omission rate</span>
    <span class="s1">&#39;TS&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">+</span> <span class="n">fp</span><span class="p">),</span>
    <span class="c1"># threat score (TS) or Critical Success Index (CSI)</span>
    <span class="s1">&#39;ACC&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">),</span>  <span class="c1"># accuracy</span>
    <span class="s1">&#39;F1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">),</span>  <span class="c1"># F1 score</span>
    <span class="s1">&#39;NMCC&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tp</span> <span class="o">*</span> <span class="n">tn</span> <span class="o">-</span> <span class="n">fp</span> <span class="o">*</span> <span class="n">fn</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="c1"># NORMALIZED TO BE BETWEEN 0 AND 1 Matthews correlation coefficient</span>
    <span class="s1">&#39;BM&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">/</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
    <span class="c1"># Informedness or Bookmaker Informedness</span>
    <span class="s1">&#39;MK&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">:</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">/</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>  <span class="c1"># Markedness</span>

<span class="n">synonyms</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;TPR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="s1">&#39;sensitivity&#39;</span><span class="p">,</span> <span class="s1">&#39;true_positive_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;hit_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;tpr&#39;</span><span class="p">],</span>
    <span class="s1">&#39;TNR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;specificity&#39;</span><span class="p">,</span> <span class="s1">&#39;SPC&#39;</span><span class="p">,</span> <span class="s1">&#39;true_negative_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;selectivity&#39;</span><span class="p">,</span> <span class="s1">&#39;tnr&#39;</span><span class="p">],</span>
    <span class="s1">&#39;PPV&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_predictive_value&#39;</span><span class="p">,</span> <span class="s1">&#39;ppv&#39;</span><span class="p">],</span>
    <span class="s1">&#39;NPV&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;negative_predictive_value&#39;</span><span class="p">,</span> <span class="s1">&#39;npv&#39;</span><span class="p">],</span>
    <span class="s1">&#39;FNR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;miss_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;false_negative_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;fnr&#39;</span><span class="p">],</span>
    <span class="s1">&#39;FPR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;fall_out&#39;</span><span class="p">,</span> <span class="s1">&#39;false_positive_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;fpr&#39;</span><span class="p">],</span>
    <span class="s1">&#39;FDR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;false_discovery_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;fdr&#39;</span><span class="p">],</span>
    <span class="s1">&#39;FOR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;false_omission_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;for&#39;</span><span class="p">],</span>
    <span class="s1">&#39;TS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;threat_score&#39;</span><span class="p">,</span> <span class="s1">&#39;critical_success_index&#39;</span><span class="p">,</span> <span class="s1">&#39;CSI&#39;</span><span class="p">,</span> <span class="s1">&#39;csi&#39;</span><span class="p">,</span> <span class="s1">&#39;ts&#39;</span><span class="p">],</span>
    <span class="s1">&#39;ACC&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;acc&#39;</span><span class="p">],</span>
    <span class="s1">&#39;F1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f1_score&#39;</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;F1_score&#39;</span><span class="p">],</span>
    <span class="s1">&#39;NMCC&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;normalized_Matthews_correlation_coefficient&#39;</span><span class="p">,</span> <span class="s1">&#39;nmcc&#39;</span><span class="p">],</span>
    <span class="s1">&#39;BM&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;informedness&#39;</span><span class="p">,</span> <span class="s1">&#39;bookmaker_informedness&#39;</span><span class="p">,</span> <span class="s1">&#39;bi&#39;</span><span class="p">,</span> <span class="s1">&#39;BI&#39;</span><span class="p">,</span> <span class="s1">&#39;bm&#39;</span><span class="p">],</span>
    <span class="s1">&#39;MK&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;markedness&#39;</span><span class="p">,</span> <span class="s1">&#39;mk&#39;</span><span class="p">],</span>
<span class="p">}</span>


<div class="viewcode-block" id="pair_metrics_to_reference"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.pair_metrics_to_reference">[docs]</a><span class="k">def</span> <span class="nf">pair_metrics_to_reference</span><span class="p">(</span>
    <span class="n">pair_metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;TPR&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;FPR&#39;</span><span class="p">},</span>
    <span class="n">outlier_proportion</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;chance line&#39;</span><span class="p">,</span>
    <span class="n">base_statistics_dict</span><span class="o">=</span><span class="n">base_statistics_dict</span><span class="p">,</span>
    <span class="n">synonyms</span><span class="o">=</span><span class="n">synonyms</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility to compute the reference/chance curve for a pair metrics type curve. Note that for certain combination</span>
<span class="sd">    of metrics, the curve may be a point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># r = rate of positive of a random outlier model</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="c1"># R = rate of positive in the test set</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>

    <span class="n">tn</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">R</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">R</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">R</span>

    <span class="n">statistics_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">base_statistics_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">statistics_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="n">synonyms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">statistics_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">statistics_dict</span><span class="p">[</span><span class="n">alt</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">fx</span> <span class="o">=</span> <span class="n">statistics_dict</span><span class="p">[</span><span class="n">pair_metrics</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]]</span>
    <span class="n">fy</span> <span class="o">=</span> <span class="n">statistics_dict</span><span class="p">[</span><span class="n">pair_metrics</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]]</span>

    <span class="n">simp_fx</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">fx</span><span class="p">(</span><span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">))</span>
    <span class="n">simp_fy</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">fy</span><span class="p">(</span><span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">))</span>

    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">y_values</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">simp_fy</span><span class="o">.</span><span class="n">evalf</span><span class="p">(</span><span class="n">subs</span><span class="o">=</span><span class="p">{</span><span class="n">R</span><span class="p">:</span> <span class="n">outlier_proportion</span><span class="p">,</span> <span class="n">simp_fx</span><span class="p">:</span> <span class="n">i</span><span class="p">})</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_values</span>
    <span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="wiggle_values_keep_order"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.wiggle_values_keep_order">[docs]</a><span class="k">def</span> <span class="nf">wiggle_values_keep_order</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wiggles the values in a list of scores so has to remove any duplicate values while keeping the same order.</span>
<span class="sd">    This is intended to use with plot_outlier_metric_curve in order to smooth the curve in situations where scores</span>
<span class="sd">    are repeating a lot</span>

<span class="sd">    &gt;&gt;&gt; scores = [1, 1, 2, 3, 3, 4, 5, 5]</span>
<span class="sd">    &gt;&gt;&gt; wiggle_values_keep_order(scores)</span>
<span class="sd">    array([1. , 1.5, 2. , 3. , 3.5, 4. , 5. , 5.5])</span>

<span class="sd">    :param values: a list of floats in general</span>
<span class="sd">    :return: a new list of float, where the values have been moved around a little, without altering their order</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">new</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_val</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">current_val_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">current_val</span><span class="p">:</span>
            <span class="n">current_val_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_val</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current_val_count</span><span class="p">):</span>
                <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">current_val</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">next_val</span> <span class="o">-</span> <span class="n">current_val</span><span class="p">)</span> <span class="o">/</span> <span class="n">current_val_count</span>
                <span class="p">)</span>
            <span class="n">current_val</span> <span class="o">=</span> <span class="n">next_val</span>
            <span class="n">current_val_count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">len_new</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
    <span class="n">last_wiggle</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="n">len_new</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="n">len_new</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="n">len_new</span><span class="p">):</span>
        <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">last_wiggle</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new</span><span class="p">)</span></div>


<div class="viewcode-block" id="cumulative_tn_fp_fn_tp"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.cumulative_tn_fp_fn_tp">[docs]</a><span class="k">def</span> <span class="nf">cumulative_tn_fp_fn_tp</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute efficiently the cumulative tn, fp, fn and tp &quot;&quot;&quot;</span>

    <span class="n">truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">truth</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;mergesort&#39;</span><span class="p">)</span>
    <span class="n">sorted_truth</span> <span class="o">=</span> <span class="n">truth</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">]</span>

    <span class="n">total_true_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sorted_truth</span><span class="p">)</span>
    <span class="n">total_true_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">sorted_truth</span><span class="p">))</span>

    <span class="n">fns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sorted_truth</span><span class="p">)))</span>
    <span class="n">tns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">sorted_truth</span><span class="p">))))</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="n">total_true_negative</span> <span class="o">-</span> <span class="n">tns</span>
    <span class="n">tps</span> <span class="o">=</span> <span class="n">total_true_positive</span> <span class="o">-</span> <span class="n">fns</span>

    <span class="k">return</span> <span class="n">tns</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">fns</span><span class="p">,</span> <span class="n">tps</span></div>


<div class="viewcode-block" id="wiggle_scores"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.wiggle_scores">[docs]</a><span class="k">def</span> <span class="nf">wiggle_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">truth</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sort scores from low to high while keeping truth aligned with it. The original values</span>
<span class="sd">    in scores which are present multiple times are spread out equally between their value and</span>
<span class="sd">    the next larger score.</span>

<span class="sd">    :param scores: a list of scores</span>
<span class="sd">    :param truth: a list of 0/1, for normal/abnormal</span>
<span class="sd">    :return: scores and truth list sorted from low to high score and where the scores have been</span>
<span class="sd">             wiggled</span>

<span class="sd">    &gt;&gt;&gt; wiggle_scores([1, 1, 2], [0, 0, 0])</span>
<span class="sd">    (array([1. , 1.5, 2. ]), array([0, 0, 0]))</span>

<span class="sd">    &gt;&gt;&gt; wiggle_scores([4, 1, 1, 2], [1, 0, 0, 0])</span>
<span class="sd">    (array([1. , 1.5, 2. , 4. ]), array([0, 0, 0, 1]))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
    <span class="n">truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">truth</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">truth</span><span class="p">))</span>
    <span class="n">z</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">scores</span><span class="p">,</span> <span class="n">truth</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wiggle_values_keep_order</span><span class="p">(</span><span class="n">scores</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">truth</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_outlier_metric_curve"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.plot_outlier_metric_curve">[docs]</a><span class="k">def</span> <span class="nf">plot_outlier_metric_curve</span><span class="p">(</span>
    <span class="n">truth</span><span class="p">,</span>
    <span class="n">scores</span><span class="p">,</span>
    <span class="n">pair_metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;TPR&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;PPV&#39;</span><span class="p">},</span>
    <span class="n">plot_curve</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">curve_legend_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_table_points_on_curve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot_chance_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">plot_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">n_points_for_table</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">axis_name_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">saving_root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">outlier_proportion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wiggle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">table_dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">base_statistics_dict</span><span class="o">=</span><span class="n">base_statistics_dict</span><span class="p">,</span>
    <span class="n">synonyms</span><span class="o">=</span><span class="n">synonyms</span><span class="p">,</span>
    <span class="n">return_rauc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">add_point_left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">add_point_right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots one outlier scores metric against another one. The metrics name can be any names in the base_statistics_dict</span>
<span class="sd">    or the synonyms dict. The chance line/curve is automatically computed and displayed along with a table</span>
<span class="sd">    of equally spaced point on the curve.</span>

<span class="sd">    :param truth: an array of 0/1, the ground truth: 0 for normal, 1 for outlier</span>
<span class="sd">    :param scores: the scores as predicted by our model. Higher scores is expected to correspond to outliers.</span>
<span class="sd">    :param pair_metrics: A dictionary with two keys, one for each of the metrics to represent. (x/y on the x/y axis)</span>
<span class="sd">    :param plot_curve: boolean, whether to plot the curve</span>
<span class="sd">    :param curve_legend_name: the name of the curve as displayed in the legend</span>
<span class="sd">    :param title: the title of the curve, by default the name of the metrics</span>
<span class="sd">    :param plot_table_points_on_curve: whether to display dots on the rauc curve corresponding to points in the table</span>
<span class="sd">    :param plot_chance_line: boolean, whether or not the display the chance line</span>
<span class="sd">    :param plot_table: boolean, whether or not to plot the table, useful to share nice pics with customers</span>
<span class="sd">    :param n_points_for_table: int, the number of equally spaced points for the table</span>
<span class="sd">    :param axis_name_dict: a dictionary specifying the name to display on the x/y axis. If set to None, the names in</span>
<span class="sd">                          pair_metrics are used</span>
<span class="sd">    :param saving_root: if set, path to the folder where the pictures will be saved.</span>
<span class="sd">    :param outlier_proportion: None or a float between 0 and 1. If a float is chosen either the normal scores or the</span>
<span class="sd">                               anomaly scores will be copied over to achieve the requested proportion of outlier</span>
<span class="sd">    :param wiggle: boolean, whether the scores will be slightly modified in order to avoid duplicate. Can</span>
<span class="sd">                          help in drawing the curve when too many scores are the same. Most often</span>
<span class="sd">                          the problem wiggle_scores solves arise from using sklearn OneClassSVM for the scores</span>
<span class="sd">                          computation</span>
<span class="sd">    :param table_dpi: int, the higher the finer the pic</span>
<span class="sd">    :param base_statistics_dict: the dictionary of possible metrics with the functions computing the metrics from</span>
<span class="sd">                                 the tn_fp_fn_tp counts. See above.</span>
<span class="sd">    :param synonyms: a dictionary containing the synonymous, allowing the user to refer to the metrics in different</span>
<span class="sd">                     terms</span>
<span class="sd">    :param return_rauc: boolean, whether or not to return the area under the curve</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make a saving folder if specified</span>
    <span class="k">if</span> <span class="n">saving_root</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">saving_root</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">saving_root</span><span class="p">)</span>

    <span class="c1"># translate the metrics requested</span>
    <span class="n">statistics_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">base_statistics_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">statistics_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="n">synonyms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">statistics_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">statistics_dict</span><span class="p">[</span><span class="n">alt</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
    <span class="n">truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">truth</span><span class="p">)</span>

    <span class="c1"># spread out the repeating scores to avoid degenerate cases</span>
    <span class="k">if</span> <span class="n">wiggle</span><span class="p">:</span>
        <span class="n">scores</span><span class="p">,</span> <span class="n">truth</span> <span class="o">=</span> <span class="n">wiggle_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">truth</span><span class="p">)</span>
    <span class="n">normal_scores</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">truth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">outlier_scores</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">truth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># TODO: this is NOT smart and can be slow if the rebalancing is drastic. Need improvement.</span>
    <span class="c1"># re-balance the proportion as required by simply copying whichever of outliers/normal elements we need</span>
    <span class="c1"># in greater quantities</span>
    <span class="k">if</span> <span class="n">outlier_proportion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">normal_scores</span><span class="p">,</span> <span class="n">outlier_scores</span> <span class="o">=</span> <span class="n">rebalancing_normal_outlier_ratio</span><span class="p">(</span>
            <span class="n">normal_scores</span><span class="p">,</span> <span class="n">outlier_scores</span><span class="p">,</span> <span class="n">percent_outliers</span><span class="o">=</span><span class="n">outlier_proportion</span>
        <span class="p">)</span>
        <span class="n">truth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">normal_scores</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">outlier_scores</span><span class="p">))</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">normal_scores</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">outlier_scores</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outlier_proportion</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outlier_scores</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">outlier_scores</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">normal_scores</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># This is the core of the function, finding the tns, fps, fns, tps and computing the values</span>
    <span class="c1"># for the metrics requested</span>
    <span class="n">tns</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">fns</span><span class="p">,</span> <span class="n">tps</span> <span class="o">=</span> <span class="n">cumulative_tn_fp_fn_tp</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fx</span> <span class="o">=</span> <span class="n">statistics_dict</span><span class="p">[</span><span class="n">pair_metrics</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]]</span>
    <span class="n">fy</span> <span class="o">=</span> <span class="n">statistics_dict</span><span class="p">[</span><span class="n">pair_metrics</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tns</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">fns</span><span class="p">,</span> <span class="n">tps</span><span class="p">):</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fx</span><span class="p">(</span><span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">))</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fy</span><span class="p">(</span><span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">))</span>

    <span class="c1"># find all the nan and remove them</span>
    <span class="n">nan_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">nan_idx</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">nan_idx</span><span class="p">]</span>

    <span class="c1"># sorting the results keeping x and y aligned</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">add_point_left</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_point_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_point_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_point_right</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">add_point_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">add_point_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Getting equally spaced points for the table or curve</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plot_curve</span> <span class="ow">and</span> <span class="n">plot_table_points_on_curve</span><span class="p">)</span> <span class="ow">or</span> <span class="n">plot_table</span><span class="p">:</span>
        <span class="n">sorted_x</span><span class="p">,</span> <span class="n">sorted_y</span> <span class="o">=</span> <span class="n">parallel_sort</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
        <span class="n">sorted_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sorted_x</span><span class="p">)</span>
        <span class="n">sorted_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sorted_y</span><span class="p">)</span>

        <span class="c1"># note that pick_equally_spaced_points is a quick hack, will not work for less than ideal situation</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">pick_equally_spaced_points</span><span class="p">(</span><span class="n">sorted_x</span><span class="p">,</span> <span class="n">n_points_for_table</span><span class="p">)</span>
        <span class="n">x_points</span> <span class="o">=</span> <span class="n">sorted_x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">y_points</span> <span class="o">=</span> <span class="n">sorted_y</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">x_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span>
        <span class="n">y_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span>
        <span class="n">xy_not_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">x_nan</span><span class="p">,</span> <span class="n">y_nan</span><span class="p">))</span>
        <span class="n">x_points</span> <span class="o">=</span> <span class="n">x_points</span><span class="p">[</span><span class="n">xy_not_nan</span><span class="p">]</span>
        <span class="n">y_points</span> <span class="o">=</span> <span class="n">y_points</span><span class="p">[</span><span class="n">xy_not_nan</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">plot_table</span> <span class="ow">or</span> <span class="n">plot_curve</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axis_name_dict</span><span class="p">:</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="n">pair_metrics</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">pair_metrics</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="n">axis_name_dict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="n">axis_name_dict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

    <span class="c1"># plotting the curve</span>
    <span class="k">if</span> <span class="n">plot_curve</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>

        <span class="n">curve_name</span> <span class="o">=</span> <span class="n">y_label</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">x_label</span> <span class="o">+</span> <span class="s1">&#39;_curve&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">curve_legend_name</span><span class="p">:</span>
            <span class="n">curve_legend_name</span> <span class="o">=</span> <span class="n">curve_name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">curve_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">curve_legend_name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

        <span class="c1"># add a reference line if specified by the user</span>
        <span class="k">if</span> <span class="n">plot_chance_line</span><span class="p">:</span>
            <span class="n">pair_metrics_to_reference</span><span class="p">(</span>
                <span class="n">pair_metrics</span><span class="o">=</span><span class="n">pair_metrics</span><span class="p">,</span> <span class="n">outlier_proportion</span><span class="o">=</span><span class="n">outlier_proportion</span>
            <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># adding the points to the curve</span>
        <span class="k">if</span> <span class="n">plot_table_points_on_curve</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;table points&#39;</span><span class="p">)</span>
        <span class="c1"># saving the curve</span>
        <span class="k">if</span> <span class="n">saving_root</span><span class="p">:</span>
            <span class="n">path_to_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_root</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plot_table</span><span class="p">:</span>
        <span class="c1"># making a panda df with the recall/precision pairs of values and saving it as a picture</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">saving_root</span><span class="p">:</span>
            <span class="n">path_to_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">saving_root</span><span class="p">,</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;_table&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path_to_save</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">render_mpl_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path_to_save</span><span class="o">=</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">table_dpi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_rauc</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">area_under_points</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))[</span><span class="mi">1</span><span class="p">:])</span></div>


<div class="viewcode-block" id="area_under_points"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.area_under_points">[docs]</a><span class="k">def</span> <span class="nf">area_under_points</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of pair corresponding to the x and y coordinates of the points, find the</span>
<span class="sd">    area under the curve of the (simplest) piecewise linear function passing by all the points</span>

<span class="sd">    &gt;&gt;&gt; area_under_points([(0, 1), (1, 1)])</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; area_under_points([(0, 1), (1, 2)])</span>
<span class="sd">    1.5</span>
<span class="sd">    &gt;&gt;&gt; area_under_points([(0, 1), (1, 2), (2, 2)])</span>
<span class="sd">    3.5</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># sort the points according to their x coordinates</span>
    <span class="n">sorted_points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">total_area</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">left_point</span> <span class="o">=</span> <span class="n">sorted_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">right_point</span> <span class="ow">in</span> <span class="n">sorted_points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">total_area</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">right_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">left_point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">right_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">left_point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">left_point</span> <span class="o">=</span> <span class="n">right_point</span>

    <span class="k">return</span> <span class="n">total_area</span></div>


<div class="viewcode-block" id="smooth_scores"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.smooth_scores">[docs]</a><span class="k">def</span> <span class="nf">smooth_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">window_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">smooth_func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Smooth an iterable of score by applying smooth_funct to each window of size window_size.</span>
<span class="sd">    If scores is smaller than window_size, an empty list is returned.</span>

<span class="sd">    :param scores: list, the scores to smooth</span>
<span class="sd">    :param window_size: int, the size of the window</span>
<span class="sd">    :param smooth_funct: function, the function applied to the windows</span>
<span class="sd">    :return: a new list of scores</span>


<span class="sd">    &gt;&gt;&gt; list(smooth_scores([1], window_size=2))</span>
<span class="sd">    []</span>
<span class="sd">    &gt;&gt;&gt; list(smooth_scores([1, 2], window_size=2))</span>
<span class="sd">    [1.5]</span>
<span class="sd">    &gt;&gt;&gt; list(smooth_scores([1, 2, 3], window_size=2, window_step=1, smooth_func=np.max))</span>
<span class="sd">    [2, 3]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">window_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">window_step</span> <span class="o">=</span> <span class="n">window_size</span>

    <span class="n">win_gen</span> <span class="o">=</span> <span class="n">fixed_step_chunker</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">chk_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span> <span class="n">chk_step</span><span class="o">=</span><span class="n">window_step</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">smooth_func</span><span class="p">,</span> <span class="n">win_gen</span><span class="p">)</span></div>


<div class="viewcode-block" id="split_on_consecutive"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.split_on_consecutive">[docs]</a><span class="k">def</span> <span class="nf">split_on_consecutive</span><span class="p">(</span><span class="n">arr_to_split</span><span class="p">,</span> <span class="n">arr_for_consec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split arr_to_split based on the entries of arr_for_consec. Each segment of consecutive</span>
<span class="sd">    equal entries in arr_for_consec will induce a split</span>

<span class="sd">    &gt;&gt;&gt; split_on_consecutive([1, 1, 2], [1, 1, 2])</span>
<span class="sd">    [array([1, 1]), array([2])]</span>
<span class="sd">    &gt;&gt;&gt; split_on_consecutive([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;], [1, 1, 2, 1, 1, 1, 3])</span>
<span class="sd">    [array([&#39;a&#39;, &#39;b&#39;], dtype=&#39;&lt;U1&#39;), array([&#39;c&#39;], dtype=&#39;&lt;U1&#39;), array([&#39;d&#39;, &#39;e&#39;, &#39;f&#39;], dtype=&#39;&lt;U1&#39;), array([&#39;g&#39;], dtype=&#39;&lt;U1&#39;)]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">split_idx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">init_value</span> <span class="o">=</span> <span class="n">arr_for_consec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr_for_consec</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">init_value</span><span class="p">:</span>
            <span class="n">split_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">init_value</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">arr_to_split</span><span class="p">,</span> <span class="n">split_idx</span><span class="p">)</span></div>


<div class="viewcode-block" id="apply_function_on_consecutive"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.apply_function_on_consecutive">[docs]</a><span class="k">def</span> <span class="nf">apply_function_on_consecutive</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">arr_for_consec</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     Apply func to each block of consecutive value in scores if the corresponding values in arr_for_consec are constant</span>
<span class="sd">    :param scores: a list of floats</span>
<span class="sd">    :param arr_for_consec: an array of values defining the blocks</span>
<span class="sd">    :return: a list the output of func on each block</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">split_scores</span> <span class="o">=</span> <span class="n">split_on_consecutive</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">arr_for_consec</span><span class="p">)</span>
    <span class="n">smoothed_scores</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">group_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">y</span><span class="p">])</span>
    <span class="c1"># little hack to see whether the function func returns a value or a list</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">group_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">scores_group</span> <span class="ow">in</span> <span class="n">split_scores</span><span class="p">:</span>
        <span class="n">group_func</span><span class="p">(</span><span class="n">smoothed_scores</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">scores_group</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">smoothed_scores</span><span class="p">)</span></div>


<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>


<div class="viewcode-block" id="parallel_sort"><a class="viewcode-back" href="../../module_docs/oplot/plot_stats.html#oplot.plot_stats.parallel_sort">[docs]</a><span class="k">def</span> <span class="nf">parallel_sort</span><span class="p">(</span><span class="n">iterable_list</span><span class="p">,</span> <span class="n">sort_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sort several lists in iterable_list in parallel, according to the the list of index sort_idx</span>
<span class="sd">    :param iterable_list: list of list, all the lists have the same length</span>
<span class="sd">    :param sort_idx: int, the index of the list to sort by</span>
<span class="sd">    :return: a list sorted tuples</span>


<span class="sd">    &gt;&gt;&gt; parallel_sort([[2, 3, 1], [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]])</span>
<span class="sd">    [(1, 2, 3), (&#39;c&#39;, &#39;a&#39;, &#39;b&#39;)]</span>

<span class="sd">    &gt;&gt;&gt; parallel_sort([[2, 3, 1], [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], [10, 9, 7]], sort_idx=2)</span>
<span class="sd">    [(1, 3, 2), (&#39;c&#39;, &#39;b&#39;, &#39;a&#39;), (7, 9, 10)]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">iterable_list</span><span class="p">)</span>
    <span class="n">sorted_z</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="n">sort_idx</span><span class="p">))]</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_z</span><span class="p">))</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>